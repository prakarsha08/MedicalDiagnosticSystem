
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <a name="TopOfPage"></a>
  
  <meta name="description" content="What a single data set can teach us about indicators of heart disease...">

  <!-- Google Fonts loaded here depending on setting in _data/options.yml true loads font, blank does not-->
   
     <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
   
   <!-- Load up MathJax script if needed ... specify in /_data/options.yml file-->
   
     <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <link rel="stylesheet" href="/css/tufte.css">

  <!--<link rel="alternate" type="application/rss+xml" title="Light on Data" href="http://lucdemortier.github.io/feed.xml" /> -->
  <!-- Load up the favicons -->


  <!-- Load up Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-78138990-1', 'auto');
    ga('send', 'pageview');

  </script>

</head>

  <body>
     
    <!--- Header and nav template site-wide -->

    <article class="group">
<div class="table-wrapper">

</div>


<p> &nbsp; </p>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style type="text/css">

      #parent {
          border: 1px solid #000;
          width: 90%;
          margin-left: auto;
          margin-right: 10%;
          color: #0900C4;
          background-color: lightyellow;
          font: Helvetica;
          font-size: 12pt;
      }

      #wrapper .child1{
          float: left;
          width: 85%;
      } 

      #wrapper .child2 {
          margin-left: 88%;
          margin-top: 5%;
      }

      div.clear {
          clear: both;
      }

      table.naked_table {
        width: 100%;
        margin-left: -20px;
        border: none;
        border-collapse: separate;
        border-spacing: 30px 20px;
      }

      table.naked_table td.input_slider {
        text-align: center;
      }

      .hd-slider-width {
        width: 70%;
      }

      .hd-number-width {
        width: 20%;
      }

      form.slider_input {
        width: 130%;
      }

      label.before_slider {
        display: inline-block;
        width: 100%;
        padding-left: 0;
        margin-left: 0;
        text-align: right;
      }

    </style>
  </head>

<body>
    
<script src="https://d3js.org/d3.v5.min.js"></script>
<div id="parent"> <!-- Main Div -->

  <div id="wrapper">

    <center>
    <h1 style="color: maroon">Heart Disease Predictor</h1>
    </center>

    <div class="child1">

      <table class="naked_table">
      <tr>
      <td>
        <label class="before_slider">
               Sex (0=female,1=male)</label></td>
      <td class="input_slider">
        <form class="slider_input">
          <input type="range" class="hd-slider-width" name="amountRange" min="0" max="1" step="1" value="0" id="nSex1" oninput="this.form.amountInput.value=this.value" />
          <input type="number" class="hd-number-width" name="amountInput" min="0" max="1" step="1" value="0" id="nSex2" oninput="this.form.amountRange.value=this.value" />
        </form></td>
      </tr>

      <tr>
      <td><label for="nRestbp" class="before_slider">
                 Resting Blood Pressure (94 - 200 mmHg)</label></td>
      <td class="input_slider">
        <form class="slider_input">
          <input type="range" class="hd-slider-width" name="amountRange" min="94" max="200" step="all" value="94" id="nRestbp1" oninput="this.form.amountInput.value=this.value" />
          <input type="number" class="hd-number-width" name="amountInput" min="94" max="200" step="all" value="94" id="nRestbp2" oninput="this.form.amountRange.value=this.value" />
        </form></td>
      </tr>

      <tr>
      <td><label for="nThalach" class="before_slider">
                 Thalium Stress Test Maximum Heart Rate (71 - 202)</label></td>
      <td class="input_slider">
        <form class="slider_input">
          <input type="range" class="hd-slider-width" name="amountRange" min="71" max="202" step="all" value="71" id="nThalach1" oninput="this.form.amountInput.value=this.value" />
          <input type="number" class="hd-number-width" name="amountInput" min="71" max="202" step="all" value="71" id="nThalach2" oninput="this.form.amountRange.value=this.value" />
        </form></td>
      </tr>

      <tr>
      <td><label for="nCa" class="before_slider">
                 Number of Major Vessels Colored by Fluoroscopy (0 - 3)</label></td>
      <td class="input_slider">
        <form class="slider_input">
          <input type="range" class="hd-slider-width" name="amountRange" min="0" max="3" step="all" value="0" id="nCa1" oninput="this.form.amountInput.value=this.value" />
          <input type="number" class="hd-number-width" name="amountInput" min="0" max="3" step="all" value="0" id="nCa2" oninput="this.form.amountRange.value=this.value" />
        </form></td>
      </tr>

      <tr>
      <td><label for="nCp" class="before_slider">
                 Chest Pain Type (1=typical angina, 2=atypical angina, 3=non-angina, 4=asymptomatic angina)</label></td>
      <td class="input_slider">
        <form class="slider_input">
          <input type="range" class="hd-slider-width" name="amountRange" min="1" max="4" step="1" value="1" id="nCp1" oninput="this.form.amountInput.value=this.value" />
          <input type="number" class="hd-number-width" name="amountInput" min="1" max="4" step="1" value="1" id="nCp2" oninput="this.form.amountRange.value=this.value" />
        </form></td>
      </tr>

      <tr>
      <td><label for="nSlope" class="before_slider">
                 Peak Exercise ST Segment (0=flat or downsloping, 1=upsloping)</label></td>
      <td class="input_slider">
        <form class="slider_input">
          <input type="range" class="hd-slider-width" name="amountRange" min="0" max="1" step="1" value="0" id="nSlope1" oninput="this.form.amountInput.value=this.value" />
          <input type="number" class="hd-number-width" name="amountInput" min="0" max="1" step="1" value="0" id="nSlope2" oninput="this.form.amountRange.value=this.value" />
        </form></td>
      </tr>

      <tr>
      <td><label for="nThal" class="before_slider">
                 Thalium Test: (0=normal or fixed defect, 1=reversible defect)</label></td>
      <td class="input_slider">
        <form class="slider_input">
          <input type="range" class="hd-slider-width" name="amountRange" min="0" max="1" step="1" value="0" id="nThal1" oninput="this.form.amountInput.value=this.value" />
          <input type="number" class="hd-number-width" name="amountInput" min="0" max="1" step="1" value="0" id="nThal2" oninput="this.form.amountRange.value=this.value" />
        </form></td>
      </tr>

      <tr>
      <td></td>
      <td class="input_slider">
          <input type="button" style="color: #0900C4" value="Reset All Sliders" onclick="updateOne(val01,-1)" />
      </td>
      </tr>

      </table>

      </div>

    <div class="child2">

      <script>

        var width  =100;
        var height = 400;
         
        var holder = d3.select(".child2")
              .append("svg")
              .attr("width", width)    
              .attr("height", height);

        // draw a rectangle
        var y0 = 20;
        var height0 = 380;
        holder.append("rect")
            .attr("x", 5)
            .attr("y", y0+height0)
            .style("fill", "rgb(0,255,0)")
            .attr("height", 0) 
            .attr("width", 90);

        // draw a container rectangle
        holder.append("rect")
        	.attr("x", 5)
        	.attr("y", y0)
        	.style("fill", "none")
        	.style("stroke", "lightblue")
        	.style("stroke-width",4)
        	.attr("height",height0)
        	.attr("width",90);

        // add text inside rectangle
 holder.append("text")
        	.text("0.00%")
        	.attr("x",0)
        	.attr("y",y0+height0-10)
        	.attr("fill","black")
          .attr("font-family","Verdana")
          .attr("font-size","20");

        // initialize
        var val01 = document.getElementById("nSex1").value;
        var val02 = document.getElementById("nRestbp1").value;
        var val03 = document.getElementById("nThalach1").value;
        var val04 = document.getElementById("nCa1").value;
        var val05 = document.getElementById("nCp1").value;
        var val06 = document.getElementById("nSlope1").value;
        var val07 = document.getElementById("nThal1").value;
        updateOne(val01,0);

        // Check for changes in the inputs and update output bar
        d3.select("#nSex1").on("input", function() {updateOne(+this.value,1);});
        d3.select("#nSex2").on("input", function() {updateOne(+this.value,1);});
        d3.select("#nRestbp1").on("input", function() {updateOne(+this.value,2);});
        d3.select("#nRestbp2").on("input", function() {updateOne(+this.value,2);});
        d3.select("#nThalach1").on("input", function() {updateOne(+this.value,3);});
        d3.select("#nThalach2").on("input", function() {updateOne(+this.value,3);});
        d3.select("#nCa1").on("input", function() {updateOne(+this.value,4);});
        d3.select("#nCa2").on("input", function() {updateOne(+this.value,4);});
        d3.select("#nCp1").on("input", function() {updateOne(+this.value,5);});
        d3.select("#nCp2").on("input", function() {updateOne(+this.value,5);});
        d3.select("#nSlope1").on("input", function() {updateOne(+this.value,6);});
        d3.select("#nSlope2").on("input", function() {updateOne(+this.value,6);});
        d3.select("#nThal1").on("input", function() {updateOne(+this.value,7);});
        d3.select("#nThal2").on("input", function() {updateOne(+this.value,7);});

        // Update the heart disease probability
        function updateOne(value,index) {

          if (index == 1) {
            val01 = value;
          } else if (index == 2) {
            val02 = value;
          } else if (index == 3) {
            val03 = value;
          } else if (index == 4) {
            val04 = value;
          } else if (index == 5) {
            val05 = value;
          } else if (index == 6) {
            val06 = value;
          } else if (index == 7) {
            val07 = value;
          } else if (index == -1) {
            // Set everything back to default state:
            val01 = document.getElementById("nSex1").defaultValue;
            document.getElementById("nSex1").value = val01;
            document.getElementById("nSex2").value = val01;
            val02 = document.getElementById("nRestbp1").defaultValue;
            document.getElementById("nRestbp1").value = val02;
            document.getElementById("nRestbp2").value = val02;
            val03 = document.getElementById("nThalach1").defaultValue;
            document.getElementById("nThalach1").value = val03;
            document.getElementById("nThalach2").value = val03;
            val04 = document.getElementById("nCa1").defaultValue;
            document.getElementById("nCa1").value = val04;
            document.getElementById("nCa2").value = val04;
            val05 = document.getElementById("nCp1").defaultValue;
            document.getElementById("nCp1").value = val05;
            document.getElementById("nCp2").value = val05;
            val06 = document.getElementById("nSlope1").defaultValue;
            document.getElementById("nSlope1").value = val06;
            document.getElementById("nSlope2").value = val06;
            val07 = document.getElementById("nThal1").defaultValue;
            document.getElementById("nThal1").value = val07;
            document.getElementById("nThal2").value = val07;
          }

          // Standardize the continuous features:
          var srbp_val     = (val02-131.7157)/17.7478;
          var sthalach_val = (val03-149.3278)/23.1211;
          var sca_val      = (val04-0.6722)/3.0;

          // Disentangle the categorical features:
          var cp_contr = 0.0;
          if (val05 == 1) {
            cp_contr = -2.2318;
          } else if (val05 == 2) {
            cp_contr = -1.2681;
          } else if (val05 == 3) {
            cp_contr = -2.1124;
          }
          var slope_contr = 0.0;
          if (val06 == 1) {slope_contr = -1.4726;}
          var thal_contr = 0.0;
          if(val07 == 1) {thal_contr = 1.5009;}

          // Compute log-odds, then probability:
          var scprod = 1.4361*val01 + 0.4415*srbp_val - 0.4431*sthalach_val + 3.7984*sca_val + cp_contr + slope_contr + thal_contr;
          var drec   = 1.0/(1.0+Math.exp(-scprod));
          var drecs  = height0*drec;
          drec       *= 100;

          
          // Update plot:
         rcolor     = percentToRGB(drec);
          holder.select("rect")
            .attr("y",y0+height0-drecs)
            .attr("height",drecs)
            .style("fill", rcolor);

      holder.select("text")
            .text(function(){return parseFloat(Math.round(drec * 100) / 100).toFixed(2)+"%";});
           
        }

        function percentToRGB(percent) {
            if (percent === 100) {
                percent = 99
            }
            var r, g, b;

            if (percent < 50) {
                // green to yellow
                r = Math.floor(255 * (percent / 50));
                g = 255;

            } else {
                // yellow to red
                r = 255;
                g = Math.floor(255 * ((50 - percent % 50) / 50));
            }
            b = 0;
            return "rgb(" + r + "," + g + "," + b + ")";
        }
        </script>
    
    </div>
  </div>
  <div class="clear"></div>
  </div>

</body>
<p> &nbsp; </p>
</footer>
  </body>
</html>
